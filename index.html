<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Steganography</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Basic styling for file input to make it look better */
        input[type="file"]::file-selector-button {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* Full rounded */
            border: 0;
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            background-color: #6D28D9; /* violet-700 */
            color: #ffffff; /* white */
            margin-right: 1rem;
            transition: background-color 0.3s ease;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #5B21B6; /* violet-800 */
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-100 to-purple-200 text-gray-800 font-inter p-4 sm:p-8 flex items-center justify-center">

    <div class="w-full max-w-4xl bg-white bg-opacity-90 rounded-xl shadow-2xl p-6 sm:p-10 border border-blue-300">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-10 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
            Secure Steganography
        </h1>

        <!-- Encoder Section -->
        <div class="mb-12 p-6 bg-blue-50 bg-opacity-80 rounded-lg border border-blue-200 shadow-md">
            <h2 class="text-3xl font-bold text-center mb-6 text-blue-700">Encode Message</h2>
            <div class="space-y-6">
                <div>
                    <label for="encodeImage" class="block text-lg font-medium text-gray-700 mb-2">
                        Upload Image
                    </label>
                    <input
                        type="file"
                        id="encodeImage"
                        accept="image/*"
                        class="w-full text-gray-700 rounded-md p-2 border border-gray-300 bg-white"
                    />
                    <p id="encodeImageName" class="mt-2 text-sm text-gray-500"></p>
                </div>

                <div>
                    <label for="encodeMessage" class="block text-lg font-medium text-gray-700 mb-2">
                        Message to Hide
                    </label>
                    <textarea
                        id="encodeMessage"
                        rows="4"
                        class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400 resize-y"
                        placeholder="Enter your secret message here..."
                    ></textarea>
                </div>

                <div>
                    <label for="encodeKey" class="block text-lg font-medium text-gray-700 mb-2">
                        Encryption Key (Password)
                    </label>
                    <input
                        type="password"
                        id="encodeKey"
                        class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                        placeholder="Choose a strong key"
                    />
                </div>

                <button
                    id="encodeButton"
                    class="w-full bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                >
                    <svg id="encodeSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="encodeButtonText">Encode Message</span>
                </button>

                <p id="encodeError" class="text-red-600 text-center mt-4"></p>

                <div id="encodedImageContainer" class="mt-6 text-center hidden">
                    <p class="text-green-600 text-lg mb-4">Encoded Image Ready!</p>
                    <img
                        id="encodedImageDisplay"
                        alt="Encoded"
                        class="max-w-full h-auto mx-auto rounded-lg shadow-md border border-gray-300"
                    />
                    <a
                        id="downloadEncodedImage"
                        download="stego_image.png"
                        class="mt-4 inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"
                    >
                        Download Encoded Image
                    </a>
                </div>
            </div>
        </div>

        <!-- Decoder Section -->
        <div class="p-6 bg-blue-50 bg-opacity-80 rounded-lg border border-blue-200 shadow-md">
            <h2 class="text-3xl font-bold text-center mb-6 text-blue-700">Decode Message</h2>
            <div class="space-y-6">
                <div>
                    <label for="decodeImage" class="block text-lg font-medium text-gray-700 mb-2">
                        Upload Steganographic Image
                    </label>
                    <input
                        type="file"
                        id="decodeImage"
                        accept="image/*"
                        class="w-full text-gray-700 rounded-md p-2 border border-gray-300 bg-white"
                    />
                    <p id="decodeImageName" class="mt-2 text-sm text-gray-500"></p>
                </div>

                <div>
                    <label for="decodeKey" class="block text-lg font-medium text-gray-700 mb-2">
                        Encryption Key (Password)
                    </label>
                    <input
                        type="password"
                        id="decodeKey"
                        class="w-full p-3 rounded-lg bg-white text-gray-800 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                        placeholder="Enter the key used for encoding"
                    />
                </div>

                <button
                    id="decodeButton"
                    class="w-full bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                >
                    <svg id="decodeSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="decodeButtonText">Decode Message</span>
                </button>

                <p id="decodeError" class="text-red-600 text-center mt-4"></p>

                <div id="decodedMessageContainer" class="mt-6 p-4 bg-white rounded-lg border border-gray-300 hidden">
                    <p class="text-green-600 text-lg mb-2">Decoded Message:</p>
                    <p id="decodedMessageDisplay" class="text-gray-800 break-words"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace with your Render backend URL after deployment
        const BACKEND_URL = 'https://image-backend-9t8k.onrender.com'; // <<< REMEMBER TO UPDATE THIS AFTER DEPLOYMENT

        // --- DOM Elements ---
        const encodeImageInput = document.getElementById('encodeImage');
        const encodeImageNameDisplay = document.getElementById('encodeImageName');
        const encodeMessageInput = document.getElementById('encodeMessage');
        const encodeKeyInput = document.getElementById('encodeKey');
        const encodeButton = document.getElementById('encodeButton');
        const encodeButtonText = document.getElementById('encodeButtonText');
        const encodeSpinner = document.getElementById('encodeSpinner');
        const encodeErrorDisplay = document.getElementById('encodeError');
        const encodedImageContainer = document.getElementById('encodedImageContainer');
        const encodedImageDisplay = document.getElementById('encodedImageDisplay');
        const downloadEncodedImageLink = document.getElementById('downloadEncodedImage');

        const decodeImageInput = document.getElementById('decodeImage');
        const decodeImageNameDisplay = document.getElementById('decodeImageName');
        const decodeKeyInput = document.getElementById('decodeKey');
        const decodeButton = document.getElementById('decodeButton');
        const decodeButtonText = document.getElementById('decodeButtonText');
        const decodeSpinner = document.getElementById('decodeSpinner');
        const decodeErrorDisplay = document.getElementById('decodeError');
        const decodedMessageContainer = document.getElementById('decodedMessageContainer');
        const decodedMessageDisplay = document.getElementById('decodedMessageDisplay');

        // --- Event Listeners ---
        encodeImageInput.addEventListener('change', (event) => {
            if (event.target.files.length > 0) {
                encodeImageNameDisplay.textContent = `Selected: ${event.target.files[0].name}`;
            } else {
                encodeImageNameDisplay.textContent = '';
            }
        });

        decodeImageInput.addEventListener('change', (event) => {
            if (event.target.files.length > 0) {
                decodeImageNameDisplay.textContent = `Selected: ${event.target.files[0].name}`;
            } else {
                decodeImageNameDisplay.textContent = '';
            }
        });

        encodeButton.addEventListener('click', handleEncode);
        decodeButton.addEventListener('click', handleDecode);

        // --- Helper Function to manage loading state ---
        function setLoading(button, spinner, textSpan, isLoading) {
            if (isLoading) {
                button.disabled = true;
                spinner.classList.remove('hidden');
                textSpan.textContent = 'Processing...';
            } else {
                button.disabled = false;
                spinner.classList.add('hidden');
                textSpan.textContent = button.id === 'encodeButton' ? 'Encode Message' : 'Decode Message';
            }
        }

        // --- Encode Function ---
        async function handleEncode() {
            const imageFile = encodeImageInput.files[0];
            const message = encodeMessageInput.value;
            const key = encodeKeyInput.value;

            if (!imageFile || !message || !key) {
                encodeErrorDisplay.textContent = 'Please provide an image, a message, and an encryption key.';
                return;
            }

            setLoading(encodeButton, encodeSpinner, encodeButtonText, true);
            encodeErrorDisplay.textContent = '';
            encodedImageContainer.classList.add('hidden');

            const formData = new FormData();
            formData.append('image', imageFile);
            formData.append('message', message);
            formData.append('key', key);

            try {
                const response = await fetch(`${BACKEND_URL}/encode`, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to encode image.');
                }

                const data = await response.json();
                encodedImageDisplay.src = `data:image/png;base64,${data.encoded_image}`;
                downloadEncodedImageLink.href = `data:image/png;base64,${data.encoded_image}`;
                encodedImageContainer.classList.remove('hidden');
            } catch (error) {
                console.error('Error encoding image:', error);
                encodeErrorDisplay.textContent = `Error: ${error.message}`;
            } finally {
                setLoading(encodeButton, encodeSpinner, encodeButtonText, false);
            }
        }

        // --- Decode Function ---
        async function handleDecode() {
            const imageFile = decodeImageInput.files[0];
            const key = decodeKeyInput.value;

            if (!imageFile || !key) {
                decodeErrorDisplay.textContent = 'Please provide an image and the encryption key.';
                return;
            }

            setLoading(decodeButton, decodeSpinner, decodeButtonText, true);
            decodeErrorDisplay.textContent = '';
            decodedMessageContainer.classList.add('hidden');

            const formData = new FormData();
            formData.append('image', imageFile);
            formData.append('key', key);

            try {
                const response = await fetch(`${BACKEND_URL}/decode`, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to decode image.');
                }

                const data = await response.json();
                decodedMessageDisplay.textContent = data.decoded_message;
                decodedMessageContainer.classList.remove('hidden');
            } catch (error) {
                console.error('Error decoding image:', error);
                decodeErrorDisplay.textContent = `Error: ${error.message}`;
            } finally {
                setLoading(decodeButton, decodeSpinner, decodeButtonText, false);
            }
        }
    </script>
</body>
</html>
